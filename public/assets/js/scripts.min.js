const CONFIG={CORE:{BASE_WIDTH:1920},ZOOM:{MIN:.5,MAX:5,SENSITIVITY:.001,STEP:.2,SMOOTH:.1},BG:{STAR_COUNT:1e3,STAR_SIZE:{MIN:.5,MAX:2},STAR_ALPHA:{MIN:.2,MAX:1},STAR_TWINKLE_SPEED:.01},SWORD:{COUNT:72,BASE_RADIUS:130,LAYER_SPACING:70,SPIN_SPEED_BASE:.07,ATTACK_DELAY_MS:180,TRAIL_LENGTH:6,SIZE:70,STUN_DURATION_MS:1e3,DURABILITY:10,RESPAWN_DELAY_MS:1e3,DEATH_WAIT_MS:2e3,SPEED_MULT:50,BREATH_SPEED:{MIN:.015,MAX:.025},FLOW_OFFSET:{MIN:40,MAX:100},ATTACK_DELAY_VAR:{BASE:6,RAND:10},FRAGMENTS:{LIFE_TIME:1500,FADE_TIME:500}},INPUT:{DOUBLE_TAP_DELAY:300},COLORS:{BG_FADE:"rgba(0, 0, 8, 0.25)",SWORD_BLADE:["#d0fff5","#7fdcc0","#3fa78a"],SWORD_TRAIL:"rgba(120, 255, 210, 0.3)",SWORD_HANDLE:"#2f7f68",SWORD_GLOW_OUTER:"#8fffe0",SWORD_GLOW_INNER:"#9fffe6",SWORD_FRAGMENT:"#4fcfb2",SWORD_AURA_SHADOW:"#fffaa0",ENEMY_PARTICLE:"#8cf0ff",ENEMY_SHADOW_SHIELD:"#00ffff",SHIELD_GLOW:"rgba(0, 255, 255, 0.8)",SHIELD_RING_PULSE:"rgba(140, 245, 255, 1)",SHIELD_RING_OUTER:"rgba(140, 245, 255, 0.2)"},ENEMY:{SPAWN_COUNT:6,SPAWN_PADDING:50,BASE_SIZE:{MIN:10,VAR:50},HP:{BASE:1,VAR:100},SHIELD_CHANCE:.3,SHIELD_MAX_HP:80,SHIELD_COLOR:"rgba(100, 200, 255, 0.4)",SHIELD_LINE:"#80dfff",DEBRIS:{COUNT:50,SPEED:{MIN:4,MAX:12},SIZE:{MIN:2,MAX:5},LIFE_DECAY:.025},PALETTES:[["#ff9999","#cc3333"],["#99ccff","#3366cc"],["#99ff99","#33cc33"],["#ffcc99","#cc6600"],["#ff99ff","#cc33cc"],["#ffff99","#cccc33"]]}},random=(t,e)=>Math.random()*(e-t)+t;class Enemy{constructor(){this.particles=[],this.respawn()}respawn(){const t=Camera.currentZoom,e=window.innerWidth/t,i=window.innerHeight/t,a=window.innerWidth/2-e/2,s=window.innerHeight/2-i/2,h=CONFIG.ENEMY.SPAWN_PADDING;this.x=random(a+h,a+e-h),this.y=random(s+h,s+i-h),this.particles=[];const r=CONFIG.ENEMY.BASE_SIZE.MIN,n=CONFIG.ENEMY.BASE_SIZE.VAR;this.r=(r+Math.pow(Math.random(),1.5)*n)*(window.innerWidth/CONFIG.CORE.BASE_WIDTH),this.maxHp=CONFIG.ENEMY.HP.BASE+Math.floor(Math.random()*CONFIG.ENEMY.HP.VAR),this.hp=this.maxHp,this.hasShield=Math.random()<CONFIG.ENEMY.SHIELD_CHANCE,this.maxShieldHp=CONFIG.ENEMY.SHIELD_MAX_HP,this.shieldHp=this.hasShield?this.maxShieldHp:0,this.cracks=[],this.shieldLevel=0,this.colors=CONFIG.ENEMY.PALETTES[Math.floor(Math.random()*CONFIG.ENEMY.PALETTES.length)]}generateCracks(t){const e=this.r+10,i=Math.random()*Math.PI*2,a=5+2*t,s=[];for(let t=0;t<a;t++){const h=i+t*Math.PI*2/a,r=[],n=4;for(let t=0;t<=n;t++){const i=e*t/n,a=0===t?0:.2*(Math.random()-.5);r.push({x:Math.cos(h+a)*i,y:Math.sin(h+a)*i})}this.cracks.push(r),s.push(r)}const h=2+t;for(let t=1;t<=h;t++){const e=Math.floor((s[0].length-1)*(t/(h+1)));for(let t=0;t<s.length;t++){const i=(t+1)%s.length,a=s[t][e],h=s[i][e];Math.random()>.2&&this.cracks.push([a,h])}}}hit(t){if(this.hasShield&&this.shieldHp>0){this.shieldHp--;let t=Math.floor((this.maxShieldHp-this.shieldHp)/20);return t>this.shieldLevel&&(this.shieldLevel=t,this.generateCracks(this.shieldLevel)),this.shieldHp<=0&&(this.hasShield=!1,this.createShieldDebris()),"shielded"}return this.hp--,this.hp<=0?(this.respawn(),"killed"):"hit"}drawShield(t,e){const i=(this.r+10)*e,a=.15*Math.sin(.006*Date.now())+.85;t.save(),t.beginPath(),t.arc(0,0,i,0,2*Math.PI),t.clip();const s=t.createRadialGradient(0,0,0,0,0,i);s.addColorStop(0,"rgba(255, 255, 255, 0)"),s.addColorStop(.7,"rgba(100, 210, 255, 0.15)"),s.addColorStop(1,`rgba(150, 240, 255, ${.3*a})`),t.fillStyle=s,t.fill(),this.cracks.length>0&&(t.beginPath(),t.strokeStyle=`rgba(255, 255, 255, ${.6+.1*this.shieldLevel})`,t.lineWidth=(1.2+.4*this.shieldLevel)*e,t.lineCap="round",t.lineJoin="round",this.cracks.forEach(i=>{t.moveTo(i[0].x*e,i[0].y*e);for(let a=1;a<i.length;a++)t.lineTo(i[a].x*e,i[a].y*e)}),t.stroke(),this.shieldLevel>=2&&(t.globalAlpha=.4,t.shadowBlur=10*e,t.shadowColor="#ffffff",t.lineWidth=2.5*e,t.stroke())),t.restore(),t.save(),t.beginPath(),t.arc(0,0,i,0,2*Math.PI),t.shadowBlur=15*e,t.shadowColor=CONFIG.COLORS.SHIELD_GLOW,t.strokeStyle=`rgba(140, 245, 255, ${a})`,t.lineWidth=3.5*e,t.stroke(),t.beginPath(),t.arc(0,0,i+3*e,0,2*Math.PI),t.strokeStyle=CONFIG.COLORS.SHIELD_RING_OUTER,t.lineWidth=1*e,t.stroke(),t.restore()}createShieldDebris(){const t=CONFIG.ENEMY.DEBRIS;for(let e=0;e<t.COUNT;e++){const e=Math.random()*Math.PI*2,i=random(t.SPEED.MIN,t.SPEED.MAX);this.particles.push({x:0,y:0,vx:Math.cos(e)*i,vy:Math.sin(e)*i,size:random(t.SIZE.MIN,t.SIZE.MAX),life:1,rotation:Math.random()*Math.PI*2,spin:random(-.5,.5)})}}draw(t,e){t.save(),t.translate(this.x,this.y),this.drawParticles(t,e),this.hasShield&&this.drawShield(t,e),this.drawBody(t,e),t.restore()}drawParticles(t,e){const i=CONFIG.ENEMY.DEBRIS.LIFE_DECAY;for(let a=this.particles.length-1;a>=0;a--){let s=this.particles[a];if(s.x+=s.vx,s.y+=s.vy,s.life-=i,s.life<=0){this.particles.splice(a,1);continue}t.save(),t.translate(s.x*e,s.y*e),t.rotate(s.rotation+=s.spin),t.globalAlpha=s.life,t.fillStyle=CONFIG.COLORS.ENEMY_PARTICLE;const h=s.size*e;t.fillRect(-h/2,-h/2,h,h),t.restore()}}drawBody(t,e){t.globalAlpha=1;const i=t.createRadialGradient(0,0,.2*this.r,0,0,this.r);i.addColorStop(0,this.colors[0]),i.addColorStop(1,this.colors[1]),t.beginPath(),t.arc(0,0,this.r,0,2*Math.PI),t.fillStyle=i,this.hasShield?(t.shadowColor=CONFIG.COLORS.ENEMY_SHADOW_SHIELD,t.shadowBlur=30*e,t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=3*e,t.stroke()):(t.shadowColor=this.colors[1],t.shadowBlur=15*e),t.fill(),t.shadowBlur=0}}class Sword{constructor(t,e){this.index=t,this.layer=Math.floor(t/24),this.baseAngle=2*Math.PI/24*(t%24),this.spinAngle=0,this.spinSpeed=CONFIG.SWORD.SPIN_SPEED_BASE/(this.layer+1)*(this.layer%2?-1:1),this.radius=(CONFIG.SWORD.BASE_RADIUS+this.layer*CONFIG.SWORD.LAYER_SPACING)*e,this.x=window.innerWidth/2,this.y=window.innerHeight/2,this.vx=0,this.vy=0,this.drawAngle=0,this.trail=[],this.breath=random(0,2*Math.PI),this.breathSpeed=random(CONFIG.SWORD.BREATH_SPEED.MIN,CONFIG.SWORD.BREATH_SPEED.MAX),this.attackDelay=this.layer*CONFIG.SWORD.ATTACK_DELAY_VAR.BASE+random(0,CONFIG.SWORD.ATTACK_DELAY_VAR.RAND),this.attackFrame=0,this.flowNoise=Math.random()*Math.PI*2,this.flowOffsetAngle=2*Math.PI/72*t,this.flowOffsetRadius=(CONFIG.SWORD.FLOW_OFFSET.MIN+Math.random()*(CONFIG.SWORD.FLOW_OFFSET.MAX-CONFIG.SWORD.FLOW_OFFSET.MIN))*e,this.isStunned=!1,this.stunTimer=0,this.maxHp=CONFIG.SWORD.DURABILITY||3,this.hp=this.maxHp,this.isDead=!1,this.respawnTimer=0,this.fragments=[],this.deathTime=0}update(t,e,i,a){if(this.isDead){const t=performance.now();return t-this.deathTime<CONFIG.SWORD.DEATH_WAIT_MS?this.fragments.forEach(t=>{t.x+=t.vx,t.y+=t.vy,t.angle+=t.va,t.vx*=.9,t.vy*=.9,t.va*=.9}):this.fragments=[],void(t>this.respawnTimer&&this.respawn(i))}if(this.isStunned)return void this.handleStun(a);this.breath+=this.breathSpeed,this.breathSpeed=random(CONFIG.SWORD.BREATH_SPEED.MIN,CONFIG.SWORD.BREATH_SPEED.MAX);const s=this.radius+8*Math.sin(this.breath)*a;i.isAttacking?this.updateAttackMode(e,i,a):this.updateGuardMode(t,s,i,a)}handleStun(t){this.x+=this.vx,this.y+=this.vy,this.vx*=.95,this.vy*=.95,this.drawAngle+=.2,this.trail.push({x:this.x,y:this.y}),this.trail.length>CONFIG.SWORD.TRAIL_LENGTH&&this.trail.shift(),performance.now()>this.stunTimer&&(this.isStunned=!1,this.vx*=.2,this.vy*=.2)}respawn(t){this.isDead=!1,this.hp=this.maxHp,this.x=t.x,this.y=t.y,this.vx=0,this.vy=0,this.isStunned=!1,this.trail=[],this.fragments=[]}updateGuardMode(t,e,i,a){const s=performance.now()/1e3*this.spinSpeed*(CONFIG.SWORD.SPEED_MULT||50),h=this.baseAngle+s,r=t.x+Math.cos(h)*e,n=t.y+Math.sin(h)*e;if(i.speed>1.5){const t=r-this.x,e=n-this.y,i=Math.hypot(t,e)||1;this.vx+=t/i*Math.min(.05*i,4*a),this.vy+=e/i*Math.min(.05*i,4*a),this.vx*=.85,this.vy*=.85,this.x+=this.vx,this.y+=this.vy,this.drawAngle=Math.atan2(this.vy,this.vx)+Math.PI/2}else{const t=r-this.x,e=n-this.y;this.x+=.12*t,this.y+=.12*e,this.vx*=.5,this.vy*=.5,Math.hypot(t,e)<.5&&(this.x=r,this.y=n);let a=(1===i.guardForm?h+Math.PI/2:Math.atan2(n-this.y,r-this.x)+Math.PI/2)-this.drawAngle;for(;a<-Math.PI;)a+=2*Math.PI;for(;a>Math.PI;)a-=2*Math.PI;this.drawAngle+=.15*a}this.attackFrame=0,this.trail=[]}updateAttackMode(t,e,i){if(this.attackFrame++,this.attackFrame<this.attackDelay)return;let a=null,s=1/0;for(const i of t){const t=Math.hypot(i.x-e.x,i.y-e.y);t<s&&(s=t,a=i)}if(a){const t=a.x-this.x,e=a.y-this.y,s=Math.hypot(t,e)||1;if(this.vx+=t/s*10*i,this.vy+=e/s*10*i,this.vx*=.92,this.vy*=.92,this.x+=this.vx,this.y+=this.vy,this.drawAngle=Math.atan2(this.vy,this.vx)+Math.PI/2,Math.hypot(this.x-a.x,this.y-a.y)<a.r+(a.hasShield?10:0)){"shielded"===a.hit(this)&&(this.hp--,this.hp<=0?this.breakSword(i):(this.isStunned=!0,this.stunTimer=performance.now()+CONFIG.SWORD.STUN_DURATION_MS,this.vx=1.5*-this.vx+10*(Math.random()-.5),this.vy=1.5*-this.vy+10*(Math.random()-.5)))}this.trail.push({x:this.x,y:this.y}),this.trail.length>CONFIG.SWORD.TRAIL_LENGTH&&this.trail.shift()}}breakSword(t){this.isDead=!0,this.deathTime=performance.now(),this.respawnTimer=this.deathTime+CONFIG.SWORD.DEATH_WAIT_MS+CONFIG.SWORD.RESPAWN_DELAY_MS;const e=CONFIG.SWORD.SIZE*t,i=Math.cos(this.drawAngle),a=Math.sin(this.drawAngle);this.fragments.push({type:"handle",x:this.x,y:this.y,vx:.2*-this.vx+random(-1,1),vy:.2*-this.vy+random(-1,1),angle:this.drawAngle,va:random(-.1,.1)}),this.fragments.push({type:"mid",x:this.x+i*(.4*e)+a*(.4*e),y:this.y+a*(.4*e)-i*(.4*e),vx:.4*-this.vx+random(-2,2),vy:.4*-this.vy+random(-2,2),angle:this.drawAngle+random(-.2,.2),va:random(-.2,.2)}),this.fragments.push({type:"tip",x:this.x+i*(.8*e)+a*(.8*e),y:this.y+a*(.8*e)-i*(.8*e),vx:.6*-this.vx+random(-3,3),vy:.6*-this.vy+random(-3,3),angle:this.drawAngle+random(-.5,.5),va:random(-.4,.4)})}draw(t,e){if(this.isDead){if(this.fragments.length>0){const i=performance.now()-this.deathTime,a=CONFIG.SWORD.FRAGMENTS.LIFE_TIME,s=CONFIG.SWORD.FRAGMENTS.FADE_TIME,h=i>a?1-(i-a)/s:1;t.save(),t.globalAlpha=h,this.drawFragments(t,e),t.restore()}}else{if(this.trail.length>1){t.beginPath(),t.moveTo(this.trail[0].x,this.trail[0].y);for(let e=1;e<this.trail.length;e++)t.lineTo(this.trail[e].x,this.trail[e].y);t.strokeStyle=CONFIG.COLORS.SWORD_TRAIL,t.lineWidth=2*e,t.stroke()}t.save(),t.translate(this.x,this.y),t.rotate(this.drawAngle),this.drawAura(t,e),this.drawBlade(t,e),t.restore()}}drawFragments(t,e){const i=CONFIG.SWORD.SIZE*e,a=4*e;this.fragments.forEach(s=>{t.save(),t.translate(s.x,s.y),t.rotate(s.angle),t.fillStyle=CONFIG.COLORS.SWORD_FRAGMENT,t.shadowColor=CONFIG.COLORS.SWORD_GLOW_OUTER,t.shadowBlur=5*e,t.beginPath(),"handle"===s.type?(t.fillStyle=CONFIG.COLORS.SWORD_HANDLE,t.fillRect(-3*e,0,6*e,14*e),t.fillStyle=CONFIG.COLORS.SWORD_BLADE[2],t.moveTo(-a/2,0),t.lineTo(a/2,0),t.lineTo(a/2,.3*-i),t.lineTo(0,.2*-i),t.lineTo(-a/2,.35*-i),t.fill()):"mid"===s.type?(t.fillStyle=CONFIG.COLORS.SWORD_BLADE[1],t.moveTo(-a/2,0),t.lineTo(a/2,0),t.lineTo(a/2,.3*-i),t.lineTo(-a/2,.25*-i),t.fill()):"tip"===s.type&&(t.fillStyle=CONFIG.COLORS.SWORD_BLADE[0],t.moveTo(-a/2,0),t.lineTo(a/2,0),t.lineTo(0,.4*-i),t.fill()),t.restore()})}drawAura(t,e){const i=Math.floor(random(2,4));t.shadowColor=CONFIG.COLORS.SWORD_AURA_SHADOW,t.shadowBlur=8*e;for(let a=0;a<i;a++){t.beginPath();let i=-random(0,CONFIG.SWORD.SIZE*e),a=random(-3,3)*e;t.moveTo(a,i);for(let s=0;s<3;s++)a+=random(-4,4)*e,i+=random(-3,3)*e,t.lineTo(a,i);t.strokeStyle=`rgba(255,255,180,${random(.3,.6)})`,t.lineWidth=1.5*e,t.stroke()}}drawBlade(t,e){const i=CONFIG.SWORD.SIZE*e,a=4*e;t.shadowColor=CONFIG.COLORS.SWORD_GLOW_OUTER,t.shadowBlur=15*e;const s=t.createLinearGradient(0,-i,0,0);s.addColorStop(0,CONFIG.COLORS.SWORD_BLADE[0]),s.addColorStop(.5,CONFIG.COLORS.SWORD_BLADE[1]),s.addColorStop(1,CONFIG.COLORS.SWORD_BLADE[2]),t.fillStyle=s,t.beginPath(),t.moveTo(-a/2,0),t.lineTo(-a/2,-i),t.quadraticCurveTo(0,-i-10*e,a/2,-i),t.lineTo(a/2,0),t.fill(),t.shadowColor=CONFIG.COLORS.SWORD_GLOW_INNER,t.fillStyle=CONFIG.COLORS.SWORD_FRAGMENT,t.beginPath(),t.roundRect(-7*e,-1.2*e,14*e,2.4*e,2.4*e),t.fill(),t.fillStyle=CONFIG.COLORS.SWORD_HANDLE,t.beginPath(),t.moveTo(-3*e,0),t.lineTo(-2*e,14*e),t.lineTo(2*e,14*e),t.lineTo(3*e,0),t.fill()}}class StarField{constructor(t,e,i){this.stars=[];const a=CONFIG.BG.STAR_COUNT||t;for(let t=0;t<a;t++)this.stars.push({x:random(-e,2*e),y:random(-i,2*i),r:random(CONFIG.BG.STAR_SIZE.MIN,CONFIG.BG.STAR_SIZE.MAX),alpha:random(CONFIG.BG.STAR_ALPHA.MIN,CONFIG.BG.STAR_ALPHA.MAX)})}draw(t,e){t.shadowBlur=0;const i=CONFIG.BG.STAR_TWINKLE_SPEED;for(const a of this.stars)a.alpha+=random(-i,i),a.alpha>CONFIG.BG.STAR_ALPHA.MAX?a.alpha=CONFIG.BG.STAR_ALPHA.MAX:a.alpha<CONFIG.BG.STAR_ALPHA.MIN&&(a.alpha=CONFIG.BG.STAR_ALPHA.MIN),t.beginPath(),t.arc(a.x,a.y,a.r*e,0,2*Math.PI),t.fillStyle=`rgba(255,255,255,${a.alpha})`,t.fill()}}const canvas=document.getElementById("c"),ctx=canvas.getContext("2d",{alpha:!1});let width,height,scaleFactor=1;const Camera={currentZoom:1,targetZoom:1,update(){this.currentZoom+=(this.targetZoom-this.currentZoom)*CONFIG.ZOOM.SMOOTH},adjustZoom(t){this.targetZoom=Math.max(CONFIG.ZOOM.MIN,Math.min(CONFIG.ZOOM.MAX,this.targetZoom+t))},screenToWorld(t,e){const i=width/2,a=height/2;return{x:(t-i)/this.currentZoom+i,y:(e-a)/this.currentZoom+a}}};function resize(){width=canvas.width=window.innerWidth,height=canvas.height=window.innerHeight,scaleFactor=width/CONFIG.CORE.BASE_WIDTH}window.addEventListener("resize",resize),resize();const Input={screenX:width/2,screenY:height/2,x:width/2,y:height/2,px:0,py:0,speed:0,isAttacking:!1,guardForm:1,attackTimer:null,isTouchDevice:"ontouchstart"in window||navigator.maxTouchPoints>0,update(){const t=Camera.screenToWorld(this.screenX,this.screenY);this.x=t.x,this.y=t.y,this.speed=Math.hypot(this.x-this.px,this.y-this.py),this.px=this.x,this.py=this.y},handleMove(t){if(t.target.closest(".btn"))return;const e=t.touches?t.touches[0]:t;this.screenX=e.clientX,this.screenY=e.clientY},handleDown(t){t.target.closest(".btn")||this.isTouchDevice||(t.preventDefault(),this.attackTimer=setTimeout(()=>{this.isAttacking=!0},CONFIG.SWORD.ATTACK_DELAY_MS))},handleUp(t){this.isTouchDevice||(this.isAttacking=!1,clearTimeout(this.attackTimer))},handleWheel(t){const e=-t.deltaY*CONFIG.ZOOM.SENSITIVITY;Camera.adjustZoom(e)}};window.addEventListener("pointermove",t=>Input.handleMove(t),{passive:!1}),window.addEventListener("pointerdown",t=>Input.handleDown(t),{passive:!1}),window.addEventListener("pointerup",t=>Input.handleUp(t)),window.addEventListener("wheel",t=>Input.handleWheel(t),{passive:!1}),document.getElementById("btn-zoom-in").addEventListener("pointerdown",t=>{t.stopPropagation(),Camera.adjustZoom(CONFIG.ZOOM.STEP)}),document.getElementById("btn-zoom-out").addEventListener("pointerdown",t=>{t.stopPropagation(),Camera.adjustZoom(-CONFIG.ZOOM.STEP)}),document.getElementById("btn-form").addEventListener("pointerdown",t=>{t.stopPropagation(),t.preventDefault(),Input.guardForm=1===Input.guardForm?2:1;const e=t.currentTarget.querySelector(".icon-form");e&&(e.style.transform=`rotate(${1===Input.guardForm?-15:165}deg)`)});const attackBtn=document.getElementById("btn-attack"),startAttack=t=>{t.stopPropagation(),t.preventDefault(),Input.isAttacking=!0},stopAttack=t=>{t.stopPropagation(),t.preventDefault(),Input.isAttacking=!1,Input.attackTimer&&clearTimeout(Input.attackTimer)};attackBtn.addEventListener("pointerdown",startAttack),attackBtn.addEventListener("pointerup",stopAttack),attackBtn.addEventListener("pointerleave",stopAttack);const enemies=[],swords=[];let starField;const guardCenter={x:width/2,y:height/2,vx:0,vy:0};function init(){starField=new StarField(250,width,height);for(let t=0;t<CONFIG.ENEMY.SPAWN_COUNT;t++)enemies.push(new Enemy);for(let t=0;t<CONFIG.SWORD.COUNT;t++)swords.push(new Sword(t,scaleFactor))}function updatePhysics(){Camera.update(),Input.update();let t=Input.x-guardCenter.x,e=Input.y-guardCenter.y;guardCenter.vx+=.04*t,guardCenter.vy+=.04*e,guardCenter.vx*=.82,guardCenter.vy*=.82,guardCenter.x+=guardCenter.vx,guardCenter.y+=guardCenter.vy}function renderCursor(){ctx.shadowBlur=10,ctx.shadowColor="#6fffe0",ctx.beginPath(),ctx.arc(Input.x,Input.y,4*scaleFactor,0,2*Math.PI),ctx.fillStyle="#6fffe0",ctx.fill(),ctx.shadowBlur=0}function animate(){ctx.fillStyle=CONFIG.COLORS.BG_FADE,ctx.fillRect(0,0,width,height),updatePhysics(),ctx.save(),ctx.translate(width/2,height/2),ctx.scale(Camera.currentZoom,Camera.currentZoom),ctx.translate(-width/2,-height/2),starField.draw(ctx,scaleFactor),ctx.save(),ctx.translate(guardCenter.x,guardCenter.y),ctx.rotate(2e-4*performance.now()),ctx.strokeStyle="rgba(120,255,210,0.1)",ctx.lineWidth=1.5*scaleFactor,ctx.beginPath(),ctx.arc(0,0,50*scaleFactor,0,2*Math.PI),ctx.stroke(),ctx.restore(),enemies.forEach(t=>t.draw(ctx,scaleFactor)),swords.forEach(t=>{t.update(guardCenter,enemies,Input,scaleFactor),t.draw(ctx,scaleFactor)}),renderCursor(),ctx.restore(),requestAnimationFrame(animate)}init(),animate();